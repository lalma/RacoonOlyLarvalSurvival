print(temp)
nc_close(temp)
time_Carr=as.POSIXct(oceantime_Carr,origin="1970-01-01",tz="GMT")
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
time_Carr=as.POSIXct(oceantime_Carr,origin="1970-01-01",tz="GMT")
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
for(x in 1:9505){
idx5=which(abs(depth_Carr[,x]+5)==min(abs(depth_Carr[,x]+5)))
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
Carr_Inlet$salinity_5[x]=salinity_Carr[idx5,x]
Carr_Inlet$oxygen_5[x]=oxygen_Carr[idx5,x]
Carr_Inlet$NO3_5[x]=NO3_Carr[idx5,x]
Carr_Inlet$phytoplankton_5[x]=phytoplankton_Carr[idx5,x]
Carr_Inlet$detritus_5[x]=detritus_Carr[idx5,x]
Carr_Inlet$zooplankton_5[x]=zooplankton_Carr[idx5,x]
Carr_Inlet$alkalinity_5[x]=alkalinity_Carr[idx5,x]
Carr_Inlet$TIC_5[x]=total_inorganic_carbon_Carr[idx5,x]
}
setwd("C:/Users/Lindsay/Dropbox/MUSCA/Taylor Oceanographic Data")
library(ncdf4)
library(lubridate)
##MUSCA
temp=nc_open('alma_2016.12.15_2017.12.31.nc')
salinity_Carr=ncvar_get(temp,"salt")
oxygen_Carr=ncvar_get(temp,"oxygen")
NO3_Carr=ncvar_get(temp,"NO3")
detritus_Carr=ncvar_get(temp,"detritus")
oceantime_Carr=ncvar_get(temp,"ocean_time")
depth_Carr=ncvar_get(temp,"z_rho")
temperature_Carr=ncvar_get(temp,"temp")
phytoplankton_Carr=ncvar_get(temp,"phytoplankton")
zooplankton_Carr=ncvar_get(temp,"zooplankton")
oxygen_Carr=ncvar_get(temp,"oxygen")
alkalinity_Carr=ncvar_get(temp,"alkalinity")
total_inorganic_carbon_Carr=ncvar_get(temp,"TIC")
print(temp)
nc_close(temp)
time_Carr=as.POSIXct(oceantime_Carr,origin="1970-01-01",tz="GMT")
View(oxygen_Carr)
View(depth_Carr)
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
for(x in 1:9505){
idx5=which(abs(depth_Carr[,x]+5)==min(abs(depth_Carr[,x]+5)))
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
Carr_Inlet$salinity_5[x]=salinity_Carr[idx5,x]
Carr_Inlet$oxygen_5[x]=oxygen_Carr[idx5,x]
Carr_Inlet$NO3_5[x]=NO3_Carr[idx5,x]
Carr_Inlet$phytoplankton_5[x]=phytoplankton_Carr[idx5,x]
Carr_Inlet$detritus_5[x]=detritus_Carr[idx5,x]
Carr_Inlet$zooplankton_5[x]=zooplankton_Carr[idx5,x]
Carr_Inlet$alkalinity_5[x]=alkalinity_Carr[idx5,x]
Carr_Inlet$TIC_5[x]=total_inorganic_carbon_Carr[idx5,x]
}
for(x in 1:9505){
idx5=which(abs(depth_Carr[,x])==min(abs(depth_Carr[,x]+5)))
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
Carr_Inlet$salinity_5[x]=salinity_Carr[idx5,x]
Carr_Inlet$oxygen_5[x]=oxygen_Carr[idx5,x]
Carr_Inlet$NO3_5[x]=NO3_Carr[idx5,x]
Carr_Inlet$phytoplankton_5[x]=phytoplankton_Carr[idx5,x]
Carr_Inlet$detritus_5[x]=detritus_Carr[idx5,x]
Carr_Inlet$zooplankton_5[x]=zooplankton_Carr[idx5,x]
Carr_Inlet$alkalinity_5[x]=alkalinity_Carr[idx5,x]
Carr_Inlet$TIC_5[x]=total_inorganic_carbon_Carr[idx5,x]
}
library(ggplot2)
ggplot(aes(x=Time,y=oxygen_5),data=Carr_Inlet)+geom_line()
write.csv(Carr_Inlet,"Carr_Inlet_5.csv",row.names = F)
View(Carr_Inlet)
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
for(x in 1:9169){
idx5=which(abs(depth_Carr[,x]+5)==min(abs(depth_Carr[,x]+5)))
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
Carr_Inlet$salinity_5[x]=salinity_Carr[idx5,x]
Carr_Inlet$oxygen_5[x]=oxygen_Carr[idx5,x]
Carr_Inlet$NO3_5[x]=NO3_Carr[idx5,x]
Carr_Inlet$phytoplankton_5[x]=phytoplankton_Carr[idx5,x]
Carr_Inlet$detritus_5[x]=detritus_Carr[idx5,x]
Carr_Inlet$zooplankton_5[x]=zooplankton_Carr[idx5,x]
Carr_Inlet$alkalinity_5[x]=alkalinity_Carr[idx5,x]
Carr_Inlet$TIC_5[x]=total_inorganic_carbon_Carr[idx5,x]
}
View(depth_Carr)
for(x in 1:9169){
idx5.5357672=which(abs(depth_Carr[,x]+5.5357672)==min(abs(depth_Carr[,x]+5.5357672)))
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
Carr_Inlet$salinity_5[x]=salinity_Carr[idx5,x]
Carr_Inlet$oxygen_5[x]=oxygen_Carr[idx5,x]
Carr_Inlet$NO3_5[x]=NO3_Carr[idx5,x]
Carr_Inlet$phytoplankton_5[x]=phytoplankton_Carr[idx5,x]
Carr_Inlet$detritus_5[x]=detritus_Carr[idx5,x]
Carr_Inlet$zooplankton_5[x]=zooplankton_Carr[idx5,x]
Carr_Inlet$alkalinity_5[x]=alkalinity_Carr[idx5,x]
Carr_Inlet$TIC_5[x]=total_inorganic_carbon_Carr[idx5,x]
}
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
Carr_Inlet$Temp_5[x]=temperature_Carr[idx5,x]
View(Carr_Inlet)
View(Carr_Inlet)
View(Carr_Inlet)
setwd("C:/Users/Lindsay/Dropbox/Raccoon/Ocean/PArker data")
library(ncdf4)
library(lubridate)
temp=nc_open('NANOOS_ORCA_Carr_Inlet_hourly.nc')
salinity_Carr=ncvar_get(temp,"salt")
oceantime_Carr=ncvar_get(temp,"ocean_time")
depth_Carr=ncvar_get(temp,"z_rho")
temperature_Carr=ncvar_get(temp,"temp")
phytoplankton_Carr=ncvar_get(temp,"phytoplankton")
setwd("C:/Users/Lindsay/Dropbox/MUSCA/Taylor Oceanographic Data")
library(ncdf4)
library(lubridate)
##MUSCA
temp=nc_open('alma_2016.12.15_2017.12.31.nc')
salinity_Tay=ncvar_get(temp,"salt")
oxygen_Tay=ncvar_get(temp,"oxygen")
NO3_Tay=ncvar_get(temp,"NO3")
detritus_Tay=ncvar_get(temp,"detritus")
oceantime_Tay=ncvar_get(temp,"ocean_time")
depth_Tay=ncvar_get(temp,"z_rho")
temperature_Tay=ncvar_get(temp,"temp")
phytoplankton_Tay=ncvar_get(temp,"phytoplankton")
zooplankton_Tay=ncvar_get(temp,"zooplankton")
oxygen_Tay=ncvar_get(temp,"oxygen")
alkalinity_Tay=ncvar_get(temp,"alkalinity")
total_inorganic_carbon_Tay=ncvar_get(temp,"TIC")
print(temp)
nc_close(temp)
View(depth_Tay)
time_Tay=as.POSIXct(oceantime_Tay,origin="1970-01-01",tz="GMT")
Tay_Inlet=data.frame(Time=time_Tay,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
for(x in 1:9169){
idx5=which(abs(depth_Tay[,x]+5)==min(abs(depth_Tay[,x]+5)))
Tay_Inlet$Temp_5[x]=temperature_Tay[idx5,x]
Tay_Inlet$salinity_5[x]=salinity_Tay[idx5,x]
Tay_Inlet$oxygen_5[x]=oxygen_Tay[idx5,x]
Tay_Inlet$NO3_5[x]=NO3_Tay[idx5,x]
Tay_Inlet$phytoplankton_5[x]=phytoplankton_Tay[idx5,x]
Tay_Inlet$detritus_5[x]=detritus_Tay[idx5,x]
Tay_Inlet$zooplankton_5[x]=zooplankton_Tay[idx5,x]
Tay_Inlet$alkalinity_5[x]=alkalinity_Tay[idx5,x]
Tay_Inlet$TIC_5[x]=total_inorganic_carbon_Tay[idx5,x]
}
setwd("C:/Users/Lindsay/Dropbox/Raccoon/Ocean/PArker data")
library(ncdf4)
library(lubridate)
temp=nc_open('NANOOS_ORCA_Carr_Inlet_hourly.nc')
salinity_Carr=ncvar_get(temp,"salt")
oceantime_Carr=ncvar_get(temp,"ocean_time")
depth_Carr=ncvar_get(temp,"z_rho")
temperature_Carr=ncvar_get(temp,"temp")
phytoplankton_Carr=ncvar_get(temp,"phytoplankton")
zooplankton_Carr=ncvar_get(temp,"zooplankton")
oxygen_Carr=ncvar_get(temp,"oxygen")
alkalinity_Carr=ncvar_get(temp,"alkalinity")
total_inorganic_carbon_Carr=ncvar_get(temp,"TIC")
nc_close(temp)
time_Carr=as.POSIXct(oceantime_Carr,origin="1970-01-01",tz="GMT")
Carr_Inlet=data.frame(Time=time_Carr,Temp_5=NA,Temp_20=NA,Salinity_5=NA,Salinity_20=NA)
View(temp)
setwd("C:/Users/Lindsay/Dropbox/MUSCA/Taylor Oceanographic Data")
library(ncdf4)
library(lubridate)
##MUSCA
temp_Tay=nc_open('alma_2016.12.15_2017.12.31.nc')
salinity_Tay=ncvar_get(temp,"salt")
oxygen_Tay=ncvar_get(temp,"oxygen")
NO3_Tay=ncvar_get(temp,"NO3")
detritus_Tay=ncvar_get(temp,"detritus")
oceantime_Tay=ncvar_get(temp,"ocean_time")
depth_Tay=ncvar_get(temp,"z_rho")
temperature_Tay=ncvar_get(temp,"temp")
phytoplankton_Tay=ncvar_get(temp,"phytoplankton")
zooplankton_Tay=ncvar_get(temp,"zooplankton")
oxygen_Tay=ncvar_get(temp,"oxygen")
alkalinity_Tay=ncvar_get(temp,"alkalinity")
total_inorganic_carbon_Tay=ncvar_get(temp,"TIC")
print(temp)
nc_close(temp)
View(depth_Tay)
time_Tay=as.POSIXct(oceantime_Tay,origin="1970-01-01",tz="GMT")
setwd("C:/Users/Lindsay/Dropbox/MUSCA/Taylor Oceanographic Data")
library(ncdf4)
library(lubridate)
##MUSCA
temp_Tay=nc_open('alma_2016.12.15_2017.12.31.nc')
salinity_Tay=ncvar_get(temp_Tay,"salt")
oxygen_Tay=ncvar_get(temp_Tay,"oxygen")
NO3_Tay=ncvar_get(temp_Tay,"NO3")
detritus_Tay=ncvar_get(temp_Tay,"detritus")
oceantime_Tay=ncvar_get(temp_Tay,"ocean_time")
depth_Tay=ncvar_get(temp_Tay,"z_rho")
temperature_Tay=ncvar_get(temp_Tay,"temp")
phytoplankton_Tay=ncvar_get(temp_Tay,"phytoplankton")
zooplankton_Tay=ncvar_get(temp_Tay,"zooplankton")
oxygen_Tay=ncvar_get(temp_Tay,"oxygen")
alkalinity_Tay=ncvar_get(temp_Tay,"alkalinity")
total_inorganic_carbon_Tay=ncvar_get(temp_Tay,"TIC")
print(temp_Tay)
nc_close(temp_Tay)
View(depth_Tay)
time_Tay=as.POSIXct(oceantime_Tay,origin="1970-01-01",tz="GMT")
View(temp_Tay)
View(temp_Tay)
View(alkalinity_Tay)
View(alkalinity_Tay)
View(alkalinity_Tay)
View(alkalinity_Tay)
View(alkalinity_Tay)
setwd("C:/Users/Lindsay/Dropbox/Raccoon/Ocean/PArker data")
library(ncdf4)
library(lubridate)
temp=nc_open('NANOOS_ORCA_Carr_Inlet_hourly.nc')
salinity_Carr=ncvar_get(temp,"salt")
oceantime_Carr=ncvar_get(temp,"ocean_time")
depth_Carr=ncvar_get(temp,"z_rho")
temperature_Carr=ncvar_get(temp,"temp")
phytoplankton_Carr=ncvar_get(temp,"phytoplankton")
zooplankton_Carr=ncvar_get(temp,"zooplankton")
oxygen_Carr=ncvar_get(temp,"oxygen")
alkalinity_Carr=ncvar_get(temp,"alkalinity")
total_inorganic_carbon_Carr=ncvar_get(temp,"TIC")
nc_close(temp)
time_Carr=as.POSIXct(oceantime_Carr,origin="1970-01-01",tz="GMT")
View(temp_Tay)
View(temp)
View(temp_Tay)
View(temp)
View(temp_Tay)
View(depth_Carr)
View(depth_Carr)
View(depth_Carr)
library(ggplot2)
ggplot(aes(x=Time,y=oxygen_5),data=Tay_Inlet)+geom_line()
Tay_Inlet=data.frame(Time=time_Tay,Temp_5=NA,oxygen_5=NA,salinity_5=NA,NO3_5=NA,phytoplankton_5=NA, detritus_5=NA, zooplankton_5=NA, alkalinity_5=NA, TIC_5=NA)
for(x in 1:1){
idx5=which(abs(depth_Tay[,x]+5)==min(abs(depth_Tay[,x]+5)))
Tay_Inlet$Temp_5[x]=temperature_Tay[idx5,x]
Tay_Inlet$salinity_5[x]=salinity_Tay[idx5,x]
Tay_Inlet$oxygen_5[x]=oxygen_Tay[idx5,x]
Tay_Inlet$NO3_5[x]=NO3_Tay[idx5,x]
Tay_Inlet$phytoplankton_5[x]=phytoplankton_Tay[idx5,x]
Tay_Inlet$detritus_5[x]=detritus_Tay[idx5,x]
Tay_Inlet$zooplankton_5[x]=zooplankton_Tay[idx5,x]
Tay_Inlet$alkalinity_5[x]=alkalinity_Tay[idx5,x]
Tay_Inlet$TIC_5[x]=total_inorganic_carbon_Tay[idx5,x]
}
idx5=which(abs(depth_Tay[,x]+5)))
idx5=which(abs(depth_Tay[,x]+5))
idx5=5
Tay_Inlet$Temp_5[x]=temperature_Tay[idx5,x]
Tay_Inlet$salinity_5[x]=salinity_Tay[idx5,x]
Tay_Inlet$oxygen_5[x]=oxygen_Tay[idx5,x]
Tay_Inlet$NO3_5[x]=NO3_Tay[idx5,x]
Tay_Inlet$phytoplankton_5[x]=phytoplankton_Tay[idx5,x]
Tay_Inlet$detritus_5[x]=detritus_Tay[idx5,x]
Tay_Inlet$zooplankton_5[x]=zooplankton_Tay[idx5,x]
Tay_Inlet$alkalinity_5[x]=alkalinity_Tay[idx5,x]
Tay_Inlet$TIC_5[x]=total_inorganic_carbon_Tay[idx5,x]
for(x in 1:1){
idx5=5
Tay_Inlet$Temp_5[x]=temperature_Tay[idx5,x]
Tay_Inlet$salinity_5[x]=salinity_Tay[idx5,x]
Tay_Inlet$oxygen_5[x]=oxygen_Tay[idx5,x]
Tay_Inlet$NO3_5[x]=NO3_Tay[idx5,x]
Tay_Inlet$phytoplankton_5[x]=phytoplankton_Tay[idx5,x]
Tay_Inlet$detritus_5[x]=detritus_Tay[idx5,x]
Tay_Inlet$zooplankton_5[x]=zooplankton_Tay[idx5,x]
Tay_Inlet$alkalinity_5[x]=alkalinity_Tay[idx5,x]
Tay_Inlet$TIC_5[x]=total_inorganic_carbon_Tay[idx5,x]
}
library(ggplot2)
ggplot(aes(x=Time,y=oxygen_5),data=Tay_Inlet)+geom_line()
write.csv(Tay_Inlet,"Tay_Inlet_5.csv",row.names = F)
write.csv(Tay_Inlet,"Tay_Inlet_5.csv",row.names = F)
View(oxygen_Tay)
View(oxygen_Tay)
View(depth_Tay)
idx5=-5.5357672
Tay_Inlet$Temp_5[x]=temperature_Tay[idx5,x]
Tay_Inlet$Temp_5[x]=temperature_Tay[-5.5357672,x]
# Select dataset, import my dataset here, has the same headings as pauls dataset for simplicity
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")#  dataset is d
#upload datasheet 38,400 lines. once for each larvae
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")
library(survminer)
library(ggplot2)
library(survival)
library(frailtyEM)
library(tidyverse)
library(here)
library(readxl)
# Select dataset, import my dataset here, has the same headings as pauls dataset for simplicity
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")#  dataset is d
d <- OlyLarvaeKMforR
View(d)
library(survival)
library(survminer)
library(ggplot2)
library(rms)
library(readxl)
setwd("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/KM curves -single treatment-locatation")
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")
#make surv object
survCI20 <-Surv(time = CI20$day, CI20$dead, type = "right")
##CI20############
CI20<-subset(OlyLarvaeKMforR, Location=="CI20")
#make surv object
survCI20 <-Surv(time = CI20$day, CI20$dead, type = "right")
sfCI20 <- survfit(survCI20 ~ Treatment, data = CI20)
summary(coxph(survCI20 ~ Treatment, data = CI20))
ggsurvplot(sf, conf.int = TRUE)
#plot Km curves
#darker color=14c, lighter color=20c
ggsurvplot(sfCI20, data=CI20, conf.int=T,  risk.table=F, pval=F,legend=c("right"),
legend.labs=c("14C","20C"),legend.title="Treatment",
palette =  c('darkgreen', '#33CC66'),
risk.table.height=.25,xlab="Time (days)", size=0.7, break.time.by = 3, break.y.by=.2, ggtheme = theme_bw() +  theme(
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank()
))
CI5<-subset(OlyLarvaeKMforR, Location=="CI5")
#make surv object
survCI5 <-Surv(time = CI5$day, CI5$dead, type = "right")
# fit model and plot without random effect
sfCI5 <- survfit(survCI5 ~ Treatment, data = CI5)
#plot Km curves
#darker color=14c, lighter color=20c
ggsurvplot(sfCI5, data=CI5, conf.int=T,  risk.table=F, pval=F,legend=c("right"),
legend.labs=c("14C","20C"),legend.title="Treatment",
palette =  c('blue4', 'steelblue'),
risk.table.height=.25,xlab="Time (days)", size=0.7, break.time.by = 3, break.y.by=.2, ggtheme = theme_bw() +  theme(
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank()
))
#DB#############
##DB############
DB<-subset(OlyLarvaeKMforR, Location=="DB")
#make surv object
survDB <-Surv(time = DB$day, DB$dead, type = "right")
# fit model and plot without random effect
sfDB <- survfit(survDB ~ Treatment, data = DB)
#plot Km curves
#darker color=14c, lighter color=20c
ggsurvplot(sfDB, data=DB, conf.int=T,  risk.table=F, pval=F,legend=c("right"),
legend.labs=c("14C","20C"),legend.title="Treatment",
palette =  c('darkred', 'red'),
risk.table.height=.25,xlab="Time (days)", size=0.7, break.time.by = 3, break.y.by=.2, ggtheme = theme_bw() +  theme(
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank()
))
##PW############
PW<-subset(OlyLarvaeKMforR, Location=="PW")
#make surv object
survPW <-Surv(time = PW$day, PW$dead, type = "right")
# fit model and plot without random effect
sfPW <- survfit(survPW ~ Treatment, data = PW)
#plot Km curves
#darker color=14c, lighter color=20c
ggsurvplot(sfPW, data=PW, conf.int=T,  risk.table=F, pval=F,legend=c("right"),
legend.labs=c("14C","20C"),legend.title="Treatment",
palette =  c('darkgoldenrod', 'darkgoldenrod1'),
risk.table.height=.25,xlab="Time (days)", size=0.7, break.time.by = 3, break.y.by=.2, ggtheme = theme_bw() +  theme(
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank()
))
library(survminer)
library(ggplot2)
library(survival)
library(frailtyEM)
library(tidyverse)
library(here)
library(readxl)
library(survival)
library(survminer)
library(ggplot2)
library(rms)
library(readxl)
library(survELtest)
#upload datasheet 38,400 lines. once for each larvae
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")
View(OlyLarvaeKMforR)
#make surv object
KMsurv = Surv(time = OlyLarvaeKMforR$day, OlyLarvaeKMforR$dead, type = "right")
# fit KM model and plot without random effect of tank
sf <- survfit(KMsurv ~ Treatment+Location, data = OlyLarvaeKMforR)
summary(coxph(KMsurv ~ Treatment*Location, data = OlyLarvaeKMforR))
#p-value <0.0001
surv_pvalue(sf)
#cox model sample code without interaction
cox1<-coxph(KMsurv~Treatment+Location, data=OlyLarvaeKMforR)
summary(cox1)
cox##<here results!!!
#cox model sample code with interaction, this is the model for the main analysis
cox<-coxph(KMsurv~Treatment*Location, data=OlyLarvaeKMforR)
cox##<here results!!!
# Select dataset, import my dataset here, has the same headings as pauls dataset for simplicity
OlyLarvaeKMforR <- read_excel("C:/Users/Lindsay/Dropbox/Raccoon/larvae/oyster/larvae survival stats/GitHub/RacoonOlyLarvalSurvival/OlyLarvaeKMforR.xlsx")#  dataset is d
d <- OlyLarvaeKMforR
#make surv object
surv = Surv(time = d$day, d$dead, type = "right")
# coxph
# fit model and plot without random effect
sf <- survfit(surv ~ Treatment+Location, data = d)
summary(coxph(surv ~ Treatment+Location, data = d))
# plot curve
ggplot(dPlot, aes(time, survival_m)) +
geom_step(aes(color = Treatment)) +
ylim(0,1) +
geom_blank()
#make surv object
KMsurv = Surv(time = OlyLarvaeKMforR$day, OlyLarvaeKMforR$dead, type = "right")
# fit KM model and plot without random effect of tank
sf <- survfit(KMsurv ~ Treatment+Location, data = OlyLarvaeKMforR)
summary(coxph(KMsurv ~ Treatment*Location, data = OlyLarvaeKMforR))
# Graph the KMsurvival distribution
#you can add pval = TRUE, but we know our p>0.0001
ggsurvplot(sf, conf.int = 0.05)
# Graph the KMsurvival distribution
#you can add pval = TRUE, but we know our p>0.0001
ggsurvplot(sf, conf.int = 0.05, p-val=T)
# Graph the KMsurvival distribution
#you can add pval = TRUE, but we know our p>0.0001
ggsurvplot(sf, conf.int = 0.05, p=T)
survdiff(formula=Surv(day,dead)~Treatment +Location, data=OlyLarvaeKMforR)
CI20
CI20end<-count(CI20$Status=="1")
CI20end<-count(CI20$Status==1)
CI20end<-count(CI20$Status)
CI20end
CI20end<-count(CI20$Status)
CI20end<-sum(CI20$Status)
CI20end
CI20end<-length(CI20$Status)
CI20end
CI20end<-sum(CI20$Status)
CI20end
CI20end/CI20tot
CI20tot<-length(CI20$Status)
CI20tot
CI20end/CI20tot
1-CI20end/CI20tot
CI5end<-sum(CI5$Status)
CI5end
CI5tot<-length(CI5$Status)
CI5tot
CI5end/CI5tot
####Percent mortality
CI2020C=subset(OlyLarvaeKMforR$TreatmentLocation="20CCI20")
####Percent mortality
CI2020C=subset(OlyLarvaeKMforR$TreatmentLocation=="20CCI20")
####Percent mortality
CI2020C=subset(OlyLarvaeKMforR$TreatmentLocation=="20CCI20")
####Percent mortality
CI2020C<-subset(OlyLarvaeKMforR, TreatmentLocation=="20CCI20")
CI2020Cend<-sum(CI2020C$Status)
CI2020Cend
CI2020Ctot<-length(CI2020C$Status)
CI2020Ctot
CI2020Cend/CI2020Ctot
CI2014C<-subset(OlyLarvaeKMforR, TreatmentLocation=="14CCI20")
CI2014Cend<-sum(CI2014C$Status)
CI2014Cend
CI2014Ctot<-length(CI2014C$Status)
CI2014Ctot
CI2014Cend/CI2014Ctot
CI514C<-subset(OlyLarvaeKMforR, TreatmentLocation=="20CCI5")
CI514Cend<-sum(CI514C$Status)
CI514Cend
CI514Ctot<-length(CI514C$Status)
CI514Ctot
CI514Cend/CI514C
CI514Cend/CI514Ctot
CI514C<-subset(OlyLarvaeKMforR, TreatmentLocation=="14CCI5")
CI514Cend<-sum(CI514C$Status)
CI514Cend
CI514Ctot<-length(CI514C$Status)
CI514Ctot
CI514Cend/CI514C
CI514Cend/CI514Ctot
DB514C<-subset(OlyLarvaeKMforR, TreatmentLocation=="14CDB")
DB514Cend<-sum(DB514C$Status)
DB514Cend
DB514Ctot<-length(DB514C$Status)
DB514Ctot
DB514Cend/DB514Ctot
DB520C<-subset(OlyLarvaeKMforR, TreatmentLocation=="20CDB")
DB520Cend<-sum(DB520C$Status)
DB520Cend
DB520Ctot<-length(DB520C$Status)
DB520Ctot
DB520Cend/DB520Ctot
PW520C<-subset(OlyLarvaeKMforR, TreatmentLocation=="20CPW")
PW520Cend<-sum(PW520C$Status)
PW520Cend
PW520Ctot<-length(PW520C$Status)
PW520Ctot
PW520Cend/PW520Ctot
PW514C<-subset(OlyLarvaeKMforR, TreatmentLocation=="14CPW")
PW514Cend<-sum(PW514C$Status)
PW514Cend
PW514Ctot<-length(PW514C$Status)
PW514Ctot
PW514Cend/PW514Ctot
